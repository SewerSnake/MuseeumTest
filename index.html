<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rijks Museum</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="react.development.js"></script>
    <script src="react-dom.development.js"></script>
    <script src="react-router-dom.js"></script>
    <script src="babel.js"></script>
    <script src="node_modules/moment/moment.js"></script>
    <script src="node_modules/moment-timezone/moment-timezone.js"></script>
    <script src="script.js" type="text/jsx"></script>
  </head>

  <body>
    <!-- Wrapper -->
    <div class="wrapper">

      <!-- Header / box1 -->
      <header id="box1">
        <div class="bg-image"></div>
        <div class="logo"></div>
        <div class="logoS"></div>
      </header>

      <!-- Main / box2-->
      <main id="box2">
        <!-- Navigation -->
      </main>

    </div>


    <script type="text/jsx">

      var destination = document.querySelector(".logo");
      var destination2 = document.querySelector(".logoS");

      class LogoLetter extends React.Component {
        render() {
          return(
            <div id="logoletter">
              {this.props.children}
            </div>
          );
        }
      }
      class LogoLetter2 extends React.Component {
        render() {
          return(
            <div id="logoletter2">
        {this.props.children}
            </div>
          );
        }
      }

      ReactDOM.render(
        <div>
          <LogoLetter>M</LogoLetter>
          <LogoLetter>U</LogoLetter>
          <LogoLetter>S</LogoLetter>
          <LogoLetter>E</LogoLetter>
          <LogoLetter>U</LogoLetter>
          <LogoLetter>M</LogoLetter>
        </div>,
        destination
      );
      ReactDOM.render(
        <div>
          <LogoLetter2>A</LogoLetter2>
          <LogoLetter2>P</LogoLetter2>
          <LogoLetter2>P</LogoLetter2>
        </div>,
        destination2
      );

      // Eric
      class ArtGallery extends React.Component {
        constructor(props) {
          super(props);
          this.state = {
            requestFailed: false
          };
        }

        componentDidMount() {
          var artistName = this.props.match.params.artistName;
          var artArr = [];

          fetch("https://www.rijksmuseum.nl/api/en/collection?key=OTlO83oj&format=json&q="
          + artistName + "&s=relevance" + "&ps=" + 10)

            .then(function(response) {
              if (!response.ok) {
                throw Error('Network request failed');
              }
              return response.json();
            })
            .then(function(result) {
              console.log(result);

              var artObjects = result.artObjects;

              for (var i = 0; i < artObjects.length; i++) {
                artArr.push(artObjects[i]);
              }

              this.setState({artArray: artArr});
            }.bind(this), () => {
              this.setState(requestFailed: true);
            });
        }

        render() {
          if (!this.state.artArray) {
            return <p>Loading...</p>
          } else if (this.state.requestFailed || this.state.artArray.length == 0) {
            return <p>Could not find what you seek</p>
          } else {

            return <div>{
              this.state.artArray.map(function(value) {
                return <p>{value.title}</p>
              })
            }</div>
          }
        }
      }

      // Petteri
      class Art extends React.Component {
        render() {

            var artists = [['rembrandt','Rembrandt'],['monet','Claude Monet'],
            ['picasso','Pablo Picasso'],['edgardegas','Edgar Degas'],
            ['vermeer','Johannes Vermeer'],['vangogh','Vincent van Gogh'],
            ['michelangelo','Michelangelo'],['davinci','Lenardo da Vinci']]

          var renderValues = artists.map(function (value) {
            var x = "Painters/"+value[0] + ".jpeg";
            var y = "art/"+value[0];
            return <Link to={y} key={value[0]}> <img src={x} /></Link>

          })
          // <p className="artistName">{value[1]}</p>


            return <section id="artList" >
            <h1>Artists</h1>
            <div>{renderValues}</div>

            </section>
        }
      }

      //Milja
      var PLANNER_API_KEY = 'hXNnSkBw';

      class Planner extends React.Component {
        constructor(props){
          super(props);
          this.state = {
            today: moment(new Date()).format('YYYY-MM-DD'),
            calendarDate: moment(new Date()).format('YYYY-MM-DD'),
            time: 0,
            events: [],
            allEvents: []
          };
          this.onChange = this.onChange.bind(this);
          this.componentDidMount = this.componentDidMount.bind(this);
        }
        componentDidMount(){
          console.log('mounted');
          var chosenDate = this.state.today;
          // this.setState({ calendarDate: this.props.today });
          // console.log('caldate '+ this.state.calendarDate);
          // var EVENT_API = 'https://www.rijksmuseum.nl/api/en/agenda/2018-06-02?key='+KEY+'&format=json';
          var EVENT_API = 'https://www.rijksmuseum.nl/api/en/agenda/'+chosenDate+'?key='+PLANNER_API_KEY+'&format=json';

          fetch(EVENT_API)
            .then(response => response.json())
            .then(result => {console.log(result)
              var allEvents = result.options;
              this.setState({allEvents: result.options});
              console.log('state: All events');
              console.log(this.state.allEvents);
              // this.setState( {calendarDate: allEvents[0].period.startDate.split('T')[0]} );
            }
          );
        }

        onChange(event){
          console.log('Date picked');
          var momentt = moment(event.target.value).format('YYYY-MM-DD');
          console.log('moment ' + momentt);
          console.log(this.state.calendarDate);
          this.setState({ calendarDate: momentt });
          var PICKED = momentt;
          var API = 'https://www.rijksmuseum.nl/api/en/agenda/'+PICKED+'?key='+PLANNER_API_KEY+'&format=json';

          fetch(API)
            .then(response => response.json())
            .then(result => {console.log(result)
              var allEvents = result.options;
              this.setState({allEvents: result.options});
            }
          );
        }

        render(){
          moment.tz.add('Europe/Amsterdam|AMT NST +0120 +0020 CEST CET|-j.w -1j.w -1k -k -20 -10|010101010101010101010101010101010101010101012323234545454545454545454545454545454545454545454545454545454545454545454545454545454545454545454545454545454545454545454545454545454545|-2aFcj.w 11b0 1iP0 11A0 1io0 1cM0 1fA0 1a00 1fA0 1a00 1fA0 1a00 1co0 1io0 1yo0 Pc0 1a00 1fA0 1Bc0 Mo0 1tc0 Uo0 1tA0 U00 1uo0 W00 1s00 VA0 1so0 Vc0 1sM0 UM0 1wo0 Rc0 1u00 Wo0 1rA0 W00 1s00 VA0 1sM0 UM0 1w00 fV0 BCX.w 1tA0 U00 1u00 Wo0 1sm0 601k WM0 1fA0 1cM0 1cM0 1cM0 16M0 1gMM0 1a00 1fA0 1cM0 1cM0 1cM0 1fA0 1a00 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1fA0 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1fA0 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1cM0 1fA0 1o00 11A0 1o00 11A0 1o00 11A0 1qM0 WM0 1qM0 WM0 1qM0 11A0 1o00 11A0 1o00 11A0 1qM0 WM0 1qM0 WM0 1qM0 WM0 1qM0 11A0 1o00 11A0 1o00 11A0 1qM0 WM0 1qM0 WM0 1qM0 11A0 1o00 11A0 1o00 11A0 1o00 11A0 1qM0 WM0 1qM0 WM0 1qM0 11A0 1o00 11A0 1o00 11A0 1qM0 WM0 1qM0 WM0 1qM0 11A0 1o00 11A0 1o00 11A0 1o00 11A0 1qM0 WM0 1qM0 WM0 1qM0 11A0 1o00 11A0 1o00 11A0 1qM0 WM0 1qM0 WM0 1qM0 WM0 1qM0 11A0 1o00 11A0 1o00|16e5');
          var border = {padding: 1, border: 1, borderStyle: 'dotted'};
          var eventsToDisplay = this.state.allEvents.map((event, index) => {
            var s = moment(event.period.startDate);
            var available = <a href={event.links.web}>Book</a>;

              moment().calendar((event.period.startDate), {
                sameDay: function(now) {
                  if (this.isBefore(now)){
                    return console.log('will  happen today');
                    // available = <a href="">Check availability</a>;
                    // return <a href="">Check availability</a>;
                  } else {
                    console.log('happened today');
                    available = 'Event has passed.';
                    return 'Event has passed.';
                  }
                }
              });

            var timeLeft = moment().diff(event.period.startDate, 'days');
            console.log('timeleft: ' + moment(event.period.startDate).diff(moment(), 'days'));
            return <tr key={index}><td>{event.period.text}</td><td>{event.exposition.name}</td><td>{available}</td></tr>;
          });

          return <div>
          <form><input type="date" min={this.state.today} onChange={this.onChange}/></form>
          <br />
          <table style={border}>
          <tbody>
          <tr><th>{this.state.calendarDate}</th></tr>
          <tr>
            <th>Start time</th>
            <th>Event</th>
            <th>Tickets</th>
          </tr>
            { eventsToDisplay }
          </tbody>
          </table>
          </div>
        }
      };

      class Home extends React.Component {
        render() {
            return <section id="section-a">
                      <div className="content-wrap">
                        <h2 className="content-title">...</h2>
                        <p>...</p>
                      </div>
                    </section>
              }
      }

      var HashRouter = ReactRouterDOM.HashRouter; var Link = ReactRouterDOM.Link; var Route = ReactRouterDOM.Route; ReactDOM.render(

      <HashRouter>
        <div>
          <nav id="navigation">
            <ul id="navUl">
              <li id="navLi">
                <Link to="/">Home</Link>
              </li>
              <li id="navLi">
                <Link to="/art">Art</Link>
              </li>
              <li id="navLi">
                <Link to="/planner">Planner</Link>
              </li>
              <li id="navLi">
                <Link to="/cafe">Cafe</Link>
              </li>
            </ul>
          </nav>
          <Route exact={true} component={Home} path="/"   />
          <Route exact={true} component={Art} path="/art"   />
          <Route component={ArtGallery} path="/art/:artistName" />
          <Route exact="true" component={Planner} today={moment().format('YYYY-MM-DD')} path="/planner" />
          <Route path="/cafe" />
        </div>
      </HashRouter>, document.getElementById('box2'));


    </script>

  </body>

</html>
